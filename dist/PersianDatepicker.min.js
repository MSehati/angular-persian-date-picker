/*
 package name: persian-date-picker package   Creation Date:2015-12-10 
*/
/*
 Author: Motahare Sehati 
*/
var PersianDatePicker=function(){function a(){x=e("div",document.body),z=x.style,z.position="absolute",z.zIndex=1e7,x.onmousedown=function(){A=!0},x.onclick=function(){y.focus()}}function b(){z.visibility="hidden"}function c(a){y.value=a,y.focus(),b(),y.onchange&&y.onchange(a)}function d(a,b){return a.substring(0,8)+(10>b?"0":"")+b}function e(a,b){var c=document.createElement(a);return b.appendChild(c),c}function f(a){y.focus();var b=m(a.substring(0,8)+"01");o(x,"");var k=e("table",x);p(k,"datePicker"),k.cellSpacing=0;var n=k.insertRow(0);p(n,"datePickerHeader");var q=e("td",n);q.colSpan=3;var r=e("button",q);o(r,"&lt;"),r.onclick=function(){f(j(a))};var t=e("span",q);o(t,v[a.substring(5,7)-1]),p(t,"datePickerMonth"),r=e("button",q),o(r,"&gt;"),r.onclick=function(){f(i(a))},q=e("td",n),q.colSpan=4,q.style.textAlign="left",r=e("button",q),o(r,"&lt;"),r.onclick=function(){f(h(a))},t=e("span",q),o(t,a.substring(0,4)),p(t,"datePickerYear"),r=e("button",q),o(r,"&gt;"),r.onclick=function(){f(g(a))};for(var z=0;7>z;z++){n=k.insertRow(z+1),6==z?p(n,"datePickerFriDay"):1!=l(z,2)&&p(n,"datePickerRow"),q=e("td",n),o(q,u[z]);for(var A=0;6>A;A++){var B=7*A+z-b+1;if(q=e("td",n),B>0&&B<=s(a)){o(q,B);var C=d(a,B),D="datePickerDay";C==y.value?D="datePickerDaySelect":C==w&&(D="datePickerToday"),p(q,D),q.onclick=function(){c(d(a,this.innerHTML))}}}}n=k.insertRow(8),p(n,"datePickerFooter"),q=e("td",n),q.colSpan=2,r=e("button",q),o(r,"امروز"),r.onclick=function(){c(w)},q=e("td",n),q.colSpan=5,q.style.textAlign="left",r=e("button",q),o(r,"خالی"),r.onclick=function(){c("")}}function g(a){var b=a.split("/");return(q(b[0])+1).toString()+"/"+b[1]+"/"+b[2]}function h(a){var b=a.split("/");return(q(b[0])-1).toString()+"/"+b[1]+"/"+b[2]}function i(a){var b=a.split("/");return b[1]<9?b[0]+"/0"+(q(b[1].substring(1,2))+1).toString()+"/"+b[2]:9==b[1]?b[0]+"/10/"+b[2]:b[1]<12?b[0]+"/"+(q(b[1])+1).toString()+"/"+b[2]:(q(b[0])+1).toString()+"/01/"+b[2]}function j(a){var b=a.split("/");return b[1]>10?b[0]+"/"+(q(b[1])-1).toString()+"/"+b[2]:b[1]>1?b[0]+"/0"+(b[1]-1).toString()+"/"+b[2]:(q(b[0])-1).toString()+"/12/"+b[2]}function k(a){return 682>682*((a-474)%2820+512)%2816}function l(a,b){return Math.abs(a-b*Math.floor(a/b))}function m(a){return l(n("1392/03/25",a),7)}function n(a,b){for(var c=r(b)-r(a),d=a.split("/"),e=b.split("/"),f=d[0]<e[0]?d[0]:e[0],g=d[0]<e[0]?e[0]:d[0],h=f;g>h;h++)c+=k(h)?d[0]<e[0]?366:-366:d[0]<e[0]?365:-365;return q(c)}function o(a,b){a.innerHTML=b}function p(a,b){a.className=b}function q(a){return parseInt(a,10)}function r(a){var b=a.split("/");return b[1]<8?31*(b[1]-1)+q(b[2]):186+30*(b[1]-7)+q(b[2])}function s(a){var b=a.split("/");return b[1]<7?31:b[1]<12?30:k(b[0])?30:29}var t="شنبه",u=new Array(t,"یک"+t,"دو"+t,"سه"+t,"چهار"+t,"پنج"+t,"جمعه"),v=new Array("فروردین","اردیبهشت","خرداد","تیر","مرداد","شهریور","مهر","آبان","آذر","دی","بهمن","اسفند"),w=null,x=null,y=null,z=null,A=!1;this.show=function(c,d){null==x&&a();var e=(new Date).getJalali().join("/");w=d&&""!=d?d:e,y=c;var g=new Date;y.value.length>0&&!g.checkDate(y.value.split("/")[0],y.value.split("/")[1],y.value.split("/")[2])&&(y.value=""),y.onblur=function(){var a=new Date,c=y.value.split("/");if(y.value.length>0&&!a.checkDate(c[0],c[1],c[2])){var d=bootbox.dialog({size:"small",message:"تاریخ وارد شده صحیح نمی باشد.",onEscape:function(){bootbox.hideAll(),y.focus()}});d.find(".modal-content").css("color","#A94442"),d.find(".modal-content").css("background-color","#F2DEDE"),d.find(".modal-content").css("border-color","#EBCCD1")}A||b(),A=!1};for(var h=0,i=0,j=y;j.offsetParent;)h+=j.offsetLeft,i+=j.offsetTop,j=j.offsetParent;z.left=h+"px",z.top=i+y.offsetHeight+"px",z.visibility="visible",f(10==y.value.length?y.value:w)}},_persianDatePicker=new PersianDatePicker;PersianDatePicker.Show=function(a,b){_persianDatePicker.show(a,b)},JalaliDate={g_days_in_month:[31,28,31,30,31,30,31,31,30,31,30,31],j_days_in_month:[31,31,31,31,31,31,30,30,30,30,30,29]},JalaliDate.jalaliToGregorian=function(a,b,c){a=parseInt(a),b=parseInt(b),c=parseInt(c);for(var d=a-979,e=b-1,f=c-1,g=365*d+8*parseInt(d/33)+parseInt((d%33+3)/4),h=0;e>h;++h)g+=JalaliDate.j_days_in_month[h];g+=f;var i=g+79,j=1600+400*parseInt(i/146097);i%=146097;var k=!0;i>=36525&&(i--,j+=100*parseInt(i/36524),i%=36524,i>=365?i++:k=!1),j+=4*parseInt(i/1461),i%=1461,i>=366&&(k=!1,i--,j+=parseInt(i/365),i%=365);for(var h=0;i>=JalaliDate.g_days_in_month[h]+(1==h&&k);h++)i-=JalaliDate.g_days_in_month[h]+(1==h&&k);var l=h+1,m=i+1;return[j,l,m]},JalaliDate.checkDate=function(a,b,c){return isNaN(a)||isNaN(b)||isNaN(c)?!1:!(0>a||a>32767||1>b||b>12||1>c||c>JalaliDate.j_days_in_month[b-1]+(12==b&&!((a-979)%33%4)))},Date.prototype.checkDate=function(a,b,c){return isNaN(a)||isNaN(b)||isNaN(c)?!1:!(0>a||a>32767||1>b||b>12||1>c||c>JalaliDate.j_days_in_month[b-1]+(12==b&&!((a-979)%33%4)))},Date.prototype.checkFullDate=function(a,b){if(!a)return!1;b||(b="/");var c=a.split(b);return isNaN(c[0])||isNaN(c[1])||isNaN(c[2])?!1:Date.prototype.checkDate(c[0],c[1],c[2])},JalaliDate.gregorianToJalali=function(a,b,c){a=parseInt(a),b=parseInt(b),c=parseInt(c);for(var d=a-1600,e=b-1,f=c-1,g=365*d+parseInt((d+3)/4)-parseInt((d+99)/100)+parseInt((d+399)/400),h=0;e>h;++h)g+=JalaliDate.g_days_in_month[h];e>1&&(d%4==0&&d%100!=0||d%400==0)&&++g,g+=f;var i=g-79,j=parseInt(i/12053);i%=12053;var k=979+33*j+4*parseInt(i/1461);i%=1461,i>=366&&(k+=parseInt((i-1)/365),i=(i-1)%365);for(var h=0;11>h&&i>=JalaliDate.j_days_in_month[h];++h)i-=JalaliDate.j_days_in_month[h];var l=h+1,m=i+1;return[k,l.toString()[1]?l:"0"+l,m.toString()[1]?m:"0"+m]},Date.prototype.setJalaliFullYear=function(a,b,c){var d=this.getDate(),e=this.getMonth(),f=this.getFullYear(),g=JalaliDate.gregorianToJalali(f,e+1,d);100>a&&(a+=1300),g[0]=a,void 0!=b&&(b>11&&(g[0]+=Math.floor(b/12),b%=12),g[1]=b+1),void 0!=c&&(g[2]=c);var h=JalaliDate.jalaliToGregorian(g[0],g[1],g[2]);return this.setFullYear(h[0],h[1]-1,h[2])},Date.prototype.setJalaliMonth=function(a,b){var c=this.getDate(),d=this.getMonth(),e=this.getFullYear(),f=JalaliDate.gregorianToJalali(e,d+1,c);a>11&&(f[0]+=math.floor(a/12),a%=12),f[1]=a+1,void 0!=b&&(f[2]=b);var g=JalaliDate.jalaliToGregorian(f[0],f[1],f[2]);return this.setFullYear(g[0],g[1]-1,g[2])},Date.prototype.setJalaliDate=function(a){var b=this.getDate(),c=this.getMonth(),d=this.getFullYear(),e=JalaliDate.gregorianToJalali(d,c+1,b);e[2]=a;var f=JalaliDate.jalaliToGregorian(e[0],e[1],e[2]);return this.setFullYear(f[0],f[1]-1,f[2])},Date.prototype.getJalaliFullYear=function(){var a=this.getDate(),b=this.getMonth(),c=this.getFullYear(),d=JalaliDate.gregorianToJalali(c,b+1,a);return d[0]},Date.prototype.getJalaliMonth=function(){var a=this.getDate(),b=this.getMonth(),c=this.getFullYear(),d=JalaliDate.gregorianToJalali(c,b+1,a);return d[1]-1},Date.prototype.getJalaliDate=function(){var a=this.getDate(),b=this.getMonth(),c=this.getFullYear(),d=JalaliDate.gregorianToJalali(c,b+1,a);return d[2]},Date.prototype.getJalaliDay=function(){var a=this.getDay();return a=(a+1)%7},Date.prototype.getJalali=function(){return JalaliDate.gregorianToJalali(this.getFullYear(),this.getMonth()+1,this.getDate())},Date.prototype.subtractJalaliDate=function(a,b,c,d,e,f){if(!this.checkDate(a,b,c)||!this.checkDate(d,e,f))return-1;var g=JalaliDate.jalaliToGregorian(a,b,c),h=JalaliDate.jalaliToGregorian(d,e,f),i=new Date(g[0],g[1],g[2]),j=new Date(h[0],h[1],h[2]),k=Math.abs(i.getTime()-j.getTime()),l=Math.ceil(k/864e5);return l},Date.prototype.jalaliAddDay=function(a,b,c,d){var e=JalaliDate.jalaliToGregorian(a,b,c),f=new Date(e[0],e[1],e[2]);return f.setDate(f.getDate()+d),JalaliDate.gregorianToJalali(f.getFullYear(),f.getMonth(),f.getDate())};var persianDatePickerApp=angular.module("PersianDatePickerApp",[]);persianDatePickerApp.directive("persianDatePicker",["$compile",function(a){function b(a,b,c){c["class"].replace(/input-icon-left|input-icon-right|input-icon|span*/gi,"");a.placeHolder||(a.placeHolder=""),elm=b.find("input")[0],elm.id=b[0].id||"persianDatePicker"+Math.floor(100*Math.random()+1).toString(),elm.type="text",elm.onchange=function(b){try{"object"==typeof b&&(b=this.value),a.$apply(function(){a.ngModel=b})}catch(c){alert(c)}},a.persianDatePicker=function(a,b){PersianDatePicker.Show(a.currentTarget,b)}}return{link:b,replace:!0,scope:{ngModel:"=",placeHolder:"@?",ngDisabled:"=?"},restrict:"E",template:"<div class='input-group form-group'><input type='text' class='form-control' ng-disabled='ngDisabled' ng-model='ngModel' autocomplete='off' ng-click='persianDatePicker($event);' placeholder='{{placeHolder}}' /> <span class='input-group-btn'> "+'<button class="btn btn-default" type="button" ng-disabled="ngDisabled" ><i class="fa fa-calendar"></i></button> </span></div>'}}]);